<!DOCTYPE html>
<html lang="uk">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css">
  <link rel="icon" href="/uploads/favicon/favicon.ico" type="image/x-icon">
  <title>–ü–∞–Ω–µ–ª—å –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞</title>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background-color: #f9f9f9;
    }

    .name-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      width: 100%;
      padding: 14px 20px;
      background-color: #37ddf3;
      box-sizing: border-box;
      border-bottom: 2px solid #ffffff;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    }

    .shop-name {
      font-size: 20px;
      color: black;
      font-weight: bold;
      user-select: none;
    }

    .auth-buttons {
      display: flex;
      gap: 10px;
    }

    .auth-buttons a {
      text-decoration: none;
      padding: 10px 15px;
      background-color: #a4ebff;
      color: black;
      border-radius: 5px;
      transition: background-color 0.3s, box-shadow 0.3s;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    }

    .auth-buttons a:hover {
      background-color: #0e9fb3;
      box-shadow: 0 4px 10px rgba(35, 165, 182, 0.6);
    }

    .topnav {
      display: flex;
      justify-content: center;
      gap: 40px;
      width: 100%;
      padding: 14px 20px;
      background: linear-gradient(90deg, #5a64f5, #3a44e1);
      border: none;
      font-weight: bold;
      transition: background-color 0.3s;
      box-shadow: inset 0 -3px 5px rgba(0, 0, 0, 0.1);
    }

    .topnav a {
      color: white;
      text-decoration: none;
      display: inline-block;
      padding: 14px 20px;
      font-weight: bold;
      transition: background-color 0.3s, color 0.3s;
      border-radius: 4px;
      margin-left: 0px;
    }

    .topnav a:hover {
      background-color: #2ac1d5;
      color: black;
      box-shadow: 0 2px 8px rgba(42, 193, 213, 0.7);
    }

    .name-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      width: 100%;
      padding: 14px 20px;
      background-color: #37ddf3;
      box-sizing: border-box;
      border-bottom: 2px solid #ffffff;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    }

    .admin-container {
      margin-left: 170px;
      padding: 20px;
    }

    #login-section,
    #admin-panel,
    .form,
    #categoryForm,
    #subcategoryForm {
      margin-top: 20px;
      padding: 20px;
    }

    .admin-panel .btn {
      margin: 10px;
      padding: 10px 20px;
      background-color: #37ddf3;
      color: black;
      border: none;
      cursor: pointer;
      transition: background-color 0.3s;
      border-radius: 5px;
    }

    .admin-panel .btn:hover {
      background-color: #37ddf3;
      color: black;
    }

    .form {
      display: none;
      margin-top: 20px;
      margin-left: 170px;
    }

    .add-options {
      margin-right: 170px;
      padding-right: 20px;
    }

    #addOptions button {
      margin-right: 10px;
      padding: 10px;
      margin-left: 170px;
      background-color: #04bd23;
      color: white;
      border: none;
      cursor: pointer;
      transition: background-color 0.3s;
      font-weight: bold;
      border-radius: 5px;
    }

    #addOptions button:hover {
      background-color: #03991c;
    }

    #editOptions button {
      margin-right: 10px;
      padding: 10px;
      margin-left: 170px;
      background-color: #ffd633;
      color: black;
      border: none;
      cursor: pointer;
      transition: background-color 0.3s;
      font-weight: bold;
      border-radius: 5px;
    }

    #editOptions button:hover {
      background-color: #f4c400;
    }

    #deleteOptions button {
      margin-right: 10px;
      padding: 10px;
      margin-left: 170px;
      background-color: #f55c5c;
      color: rgb(0, 0, 0);
      border: none;
      cursor: pointer;
      transition: background-color 0.3s;
      font-weight: bold;
      border-radius: 5px;
    }

    #deleteOptions button:hover {
      background-color: #d84343;
    }

    #category,
    #subcategory {
      color: black;
      background-color: #e6f4f8;
    }
  </style>

<body>
  <div class="name-bar">
    <div class="shop-name">Plumbering shop</div>
    <div class="auth-buttons" id="authButtons">
      <a href="login.html" id="loginBtn">–£–≤—ñ–π—Ç–∏</a>
      <a href="/logout" id="logoutBtn" style="display:none;">–í–∏–π—Ç–∏</a>
      <a href="cart.html">–ö–æ—à–∏–∫ üõí</a>
    </div>
  </div>

  <!-- –ù–∞–≤—ñ–≥–∞—Ü—ñ–π–Ω–∞ –ø–∞–Ω–µ–ª—å -->
  <nav class="topnav">
    <a href="main.html">–ì–æ–ª–æ–≤–Ω–∞</a>
    <a href="aboutUs.html">–ü—Ä–æ –Ω–∞—Å</a>
    <a href="admin.html">–ê–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä</a>
  </nav>

  <!-- –ü—Ä–∞–≤–∏–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
  <div class="admin-container">
    <!-- –í—Ö—ñ–¥ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞ -->
    <section id="login-section">
      <h2>–í—Ö—ñ–¥ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞</h2>
      <form id="adminLoginForm">
        <label for="password">–ü–∞—Ä–æ–ª—å:</label>
        <input type="password" id="password" name="password">
        <button type="submit">–£–≤—ñ–π—Ç–∏</button>
      </form>
      <p id="loginMessage"></p>
    </section>

    <!-- –ü–∞–Ω–µ–ª—å –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞ -->
    <section id="admin-panel" class="admin-panel" style="display: none;">
      <h2>–ü–∞–Ω–µ–ª—å –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞</h2>
      <button class="btn" onclick="showAddOptions()">–î–æ–¥–∞—Ç–∏</button>
      <button class="btn" onclick="showEditOptions()">–†–µ–¥–∞–≥—É–≤–∞—Ç–∏</button>
      <button class="btn" onclick="showDeleteOptions()">–í–∏–¥–∞–ª–∏—Ç–∏</button>

      <button onclick="cleanupImages()">–û—á–∏—Å—Ç–∏—Ç–∏ –∑–∞–π–≤—ñ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è</button>
      <div id="cleanup-result"></div>
    </section>

    <!-- –î–û–î–ê–í–ê–ù–ù–Ø -->
    <!-- –í–∏–±—ñ—Ä –¥—ñ—ó –¥–ª—è –î–æ–¥–∞—Ç–∏-->
    <div class="add-options" id="addOptions" style="display: none;">
      <button onclick="showForm('productForm')">–¢–æ–≤–∞—Ä</button>
      <button onclick="showForm('subcategoryForm')">–ü—ñ–¥–∫–∞—Ç–µ–≥–æ—Ä—ñ—é</button>
      <button onclick="showForm('categoryForm')">–ö–∞—Ç–µ–≥–æ—Ä—ñ—é</button>
    </div>

    <!-- –§–æ—Ä–º–∞ –¥–æ–¥–∞–≤–∞–Ω–Ω—è —Ç–æ–≤–∞—Ä—É -->
    <div id="productForm" class="form">
      <h3>–î–æ–¥–∞—Ç–∏ —Ç–æ–≤–∞—Ä</h3>
      <form id="addProductForm" enctype="multipart/form-data" method="POST">
        <img id="currentItemImage" src="" alt="–ó–æ–±—Ä–∞–∂–µ–Ω–Ω—è —Ç–æ–≤–∞—Ä—É" style="max-width: 200px;"><br><br>
        <input type="file" id="editItemImage" name="image" accept="image/*">
        <input type="text" id="productName" name="name" placeholder="–ù–∞–∑–≤–∞ —Ç–æ–≤–∞—Ä—É" required>
        <select id="category" name="category" required></select>
        <select id="subcategory" name="subcategory"></select>
        <textarea id="productDescription" name="description" placeholder="–û–ø–∏—Å" required></textarea>
        <input type="number" id="productPrice" name="price" placeholder="–¶—ñ–Ω–∞" step="0.01" required>
        <input type="number" id="productStock" name="stock" placeholder="–ö—ñ–ª—å–∫—ñ—Å—Ç—å" required>
        <button type="submit">–î–æ–¥–∞—Ç–∏ —Ç–æ–≤–∞—Ä</button>
      </form>
    </div>

    <!-- –§–æ—Ä–º–∞ –¥–æ–¥–∞–≤–∞–Ω–Ω—è –ø—ñ–¥–∫–∞—Ç–µ–≥–æ—Ä—ñ—ó -->
    <div id="subcategoryForm" class="form">
      <h3>–î–æ–¥–∞—Ç–∏ –ø—ñ–¥–∫–∞—Ç–µ–≥–æ—Ä—ñ—é</h3>
      <form id="addSubcategoryForm">
        <select id="subcategoryCategory" required></select>
        <input type="text" id="subcategoryName" placeholder="–ù–∞–∑–≤–∞ –ø—ñ–¥–∫–∞—Ç–µ–≥–æ—Ä—ñ—ó" required>
        <button type="submit">–î–æ–¥–∞—Ç–∏ –ø—ñ–¥–∫–∞—Ç–µ–≥–æ—Ä—ñ—é</button>
      </form>
    </div>
  </div>

  <!-- –§–æ—Ä–º–∞ –¥–æ–¥–∞–≤–∞–Ω–Ω—è –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó -->
  <div id="categoryForm" class="form">
    <h3>–î–æ–¥–∞—Ç–∏ –∫–∞—Ç–µ–≥–æ—Ä—ñ—é</h3>
    <form id="addCategoryForm">
      <input type="text" id="categoryName" placeholder="–ù–∞–∑–≤–∞ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó" required>
      <button type="submit">–î–æ–¥–∞—Ç–∏ –∫–∞—Ç–µ–≥–æ—Ä—ñ—é</button>
    </form>
  </div>

  <!-- –†–ï–î–ê–ì–£–í–ê–ù–ù–Ø -->
  <!-- –í–∏–±—ñ—Ä –¥–ª—è —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è -->
  <div class="edit-options" id="editOptions" style="display: none;">
    <button onclick="showForm('selectItemToEdit')">–¢–æ–≤–∞—Ä</button>
    <button onclick="showForm('selectSubcategoryToEdit')">–ü—ñ–¥–∫–∞—Ç–µ–≥–æ—Ä—ñ—é</button>
    <button onclick="showForm('selectCategoryToEdit')">–ö–∞—Ç–µ–≥–æ—Ä—ñ—é</button>
  </div>

  <!-- –í–∏–±—ñ—Ä —Ç–æ–≤–∞—Ä—É -->
  <div id="selectItemToEdit" class="form" style="display: none;">
    <h3>–û–±–µ—Ä—ñ—Ç—å —Ç–æ–≤–∞—Ä –¥–ª—è —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è</h3>
    <select id="editItemSelect" required></select>
    <button id="loadItemDataBtn" type="button">–í–∏–±—Ä–∞—Ç–∏</button>
  </div>

  <!-- –§–æ—Ä–º–∞ —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è —Ç–æ–≤–∞—Ä—É -->
  <div id="editItemForm" class="form" style="display: none;">
    <h3>–†–µ–¥–∞–≥—É–≤–∞—Ç–∏ —Ç–æ–≤–∞—Ä</h3>
    <form id="editItemFormElement">
      <input type="hidden" id="editItemIdItem">

      <label>–ù–∞–∑–≤–∞ —Ç–æ–≤–∞—Ä—É (–ø–æ—Ç–æ—á–Ω–∞): <span id="currentItemName"></span></label>
      <input type="text" id="editItemNameItem" placeholder="–ù–æ–≤–∞ –Ω–∞–∑–≤–∞ —Ç–æ–≤–∞—Ä—É">

      <label>–¶—ñ–Ω–∞ (–ø–æ—Ç–æ—á–Ω–∞): <span id="currentPrice"></span></label>
      <input type="number" id="editPriceItem" placeholder="–ù–æ–≤–∞ —Ü—ñ–Ω–∞" step="0.01" min="0">

      <label>–ü–æ—Ç–æ—á–Ω–µ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è:</label><br>
      <img id="currentImage" src="/uploads/products/no-image.jpg" alt="–ü–æ—Ç–æ—á–Ω–µ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è" width="150">

      <label>–û–Ω–æ–≤–∏—Ç–∏ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è:</label>
      <input type="file" id="editImageItem" accept="image/*">

      <label>–ö–∞—Ç–µ–≥–æ—Ä—ñ—è (–ø–æ—Ç–æ—á–Ω–∞): <span id="currentCategoryName"></span></label>
      <select id="editCategoryItem"></select>

      <label>–ü—ñ–¥–∫–∞—Ç–µ–≥–æ—Ä—ñ—è (–ø–æ—Ç–æ—á–Ω–∞): <span id="currentSubcategoryName"></span></label>
      <select id="editSubcategoryItem"></select>

      <label>–ö—ñ–ª—å–∫—ñ—Å—Ç—å (–ø–æ—Ç–æ—á–Ω–∞): <span id="currentQuantity"></span></label>
      <input type="number" id="editQuantityItem" placeholder="–ù–æ–≤–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å" min="0">

      <label>–û–ø–∏—Å (–ø–æ—Ç–æ—á–Ω–∏–π): <span id="currentDescription"></span></label>
      <textarea id="editDescriptionItem" placeholder="–ù–æ–≤–∏–π –æ–ø–∏—Å"></textarea>

      <button type="submit">–û–Ω–æ–≤–∏—Ç–∏ —Ç–æ–≤–∞—Ä</button>
    </form>
  </div>

  <!-- –í–∏–±—ñ—Ä –ø—ñ–¥–∫–∞—Ç–µ–≥–æ—Ä—ñ—ó -->
  <div id="selectSubcategoryToEdit" class="form" style="display: none;">
    <h3>–û–±–µ—Ä—ñ—Ç—å –ø—ñ–¥–∫–∞—Ç–µ–≥–æ—Ä—ñ—é –¥–ª—è —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è</h3>

    <label for="editSubcategoryCategorySelect">–ö–∞—Ç–µ–≥–æ—Ä—ñ—è:</label>
    <select id="editSubcategoryCategorySelect" required></select>

    <label for="editSubcategorySelect">–ü—ñ–¥–∫–∞—Ç–µ–≥–æ—Ä—ñ—è: </label>
    <select id="editSubcategorySelect" required></select>

    <button id="loadSubcategoryDataBtn" type="button">–í–∏–±—Ä–∞—Ç–∏</button>
  </div>

  <!-- –§–æ—Ä–º–∞ —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è –ø—ñ–¥–∫–∞—Ç–µ–≥–æ—Ä—ñ—ó -->
  <div id="editSubcategoryForm" class="form" style="display: none;">
    <h3>–†–µ–¥–∞–≥—É–≤–∞—Ç–∏ –ø—ñ–¥–∫–∞—Ç–µ–≥–æ—Ä—ñ—é</h3>
    <form id="editSubcategoryFormElement">
      <input type="hidden" id="editSubcategoryId">

      <label>–ù–∞–∑–≤–∞ –ø—ñ–¥–∫–∞—Ç–µ–≥–æ—Ä—ñ—ó (–ø–æ—Ç–æ—á–Ω–∞): <span id="currentSubcategoryNameSub"></span></label>

      <label for="editSubcategoryCategoryNameInForm">–û–±–µ—Ä—ñ—Ç—å –∫–∞—Ç–µ–≥–æ—Ä—ñ—é:</label>
      <select id="editSubcategoryCategoryNameInForm" required></select>

      <label for="editSubcategoryName">–ù–æ–≤–∞ –Ω–∞–∑–≤–∞ –ø—ñ–¥–∫–∞—Ç–µ–≥–æ—Ä—ñ—ó:</label>
      <input type="text" id="editSubcategoryName" placeholder="–ù–æ–≤–∞ –Ω–∞–∑–≤–∞ –ø—ñ–¥–∫–∞—Ç–µ–≥–æ—Ä—ñ—ó" required>

      <button type="submit">–û–Ω–æ–≤–∏—Ç–∏ –ø—ñ–¥–∫–∞—Ç–µ–≥–æ—Ä—ñ—é</button>
    </form>
  </div>

  <!-- –í–∏–±—ñ—Ä –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó -->
  <div id="selectCategoryToEdit" class="form" style="display: none;">
    <h3>–û–±–µ—Ä—ñ—Ç—å –∫–∞—Ç–µ–≥–æ—Ä—ñ—é –¥–ª—è —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è</h3>
    <select id="editCategorySelect" required></select>
    <button id="loadCategoryDataBtn" type="button">–í–∏–±—Ä–∞—Ç–∏</button>
  </div>

  <!-- –§–æ—Ä–º–∞ —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó -->
  <div id="editCategoryForm" class="form" style="display: none;">
    <h3>–†–µ–¥–∞–≥—É–≤–∞—Ç–∏ –∫–∞—Ç–µ–≥–æ—Ä—ñ—é</h3>
    <form id="editCategoryFormElement">
      <input type="hidden" id="editCategoryCategoryId">

      <label>–ö–∞—Ç–µ–≥–æ—Ä—ñ—è (–ø–æ—Ç–æ—á–Ω–∞): <span id="currentCategoryNameCat"></span></label>

      <label>–ù–æ–≤–∞ –Ω–∞–∑–≤–∞ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó: </label>
      <input type="text" id="editCategoryName" placeholder="–ù–æ–≤–∞ –Ω–∞–∑–≤–∞" required>

      <button type="submit">–û–Ω–æ–≤–∏—Ç–∏ –∫–∞—Ç–µ–≥–æ—Ä—ñ—é</button>
    </form>
  </div>

  <!-- –í–ò–î–ê–õ–ï–ù–ù–Ø -->
  <!-- –í–∏–±—ñ—Ä –¥–ª—è –≤–∏–¥–∞–ª–µ–Ω–Ω—è -->
  <div class="edit-options" id="deleteOptions" style="display: none;">
    <button onclick="showForm('selectItemToDelete')">–¢–æ–≤–∞—Ä</button>
    <button onclick="showForm('selectSubcategoryToDelete'); initDeleteSubcategoryForm();">–ü—ñ–¥–∫–∞—Ç–µ–≥–æ—Ä—ñ—é</button>
    <button onclick="showForm('selectCategoryToDelete')">–ö–∞—Ç–µ–≥–æ—Ä—ñ—é</button>
  </div>

  <!-- –í–∏–±—ñ—Ä –æ–±'—î–∫—Ç—É -->
  <div id="selectItemToDelete" class="form" style="display: none;">
    <h3>–û–±–µ—Ä—ñ—Ç—å –æ–±'—î–∫—Ç –¥–ª—è –≤–∏–¥–∞–ª–µ–Ω–Ω—è</h3>
    <select id="deleteItemSelect" required></select>
    <button id="loadItemToDeleteBtn" type="button">–í–∏–±—Ä–∞—Ç–∏</button>
  </div>


  <div id="deleteItemForm" class="form" style="display: none;">
    <h3>–í–∏–¥–∞–ª–∏—Ç–∏ —Ç–æ–≤–∞—Ä</h3>
    <form id="deleteItemFormElement">
      <input type="hidden" id="deleteItemId">
      <p><strong>–ù–∞–∑–≤–∞:</strong> <span id="deleteItemName"></span></p>
      <p><strong>–¶—ñ–Ω–∞:</strong> <span id="deleteItemPrice"></span></p>
      <p><strong>–ö–∞—Ç–µ–≥–æ—Ä—ñ—è:</strong> <span id="deleteItemCategory"></span></p>
      <p><strong>–ü—ñ–¥–∫–∞—Ç–µ–≥–æ—Ä—ñ—è:</strong> <span id="deleteItemSubcategory"></span></p>
      <p><strong>–ö—ñ–ª—å–∫—ñ—Å—Ç—å:</strong> <span id="deleteItemStock"></span></p>
      <p><strong>–û–ø–∏—Å:</strong> <span id="deleteItemDescription"></span></p>
      <img id="deleteItemImage" src="/uploads/products/no-image.jpg" alt="–ó–æ–±—Ä–∞–∂–µ–Ω–Ω—è —Ç–æ–≤–∞—Ä—É" width="150">
      <button type="submit">–í–∏–¥–∞–ª–∏—Ç–∏</button>
    </form>
  </div>

  <!-- –§–æ—Ä–º–∞ –≤–∏–¥–∞–ª–µ–Ω–Ω—è –ø—ñ–¥–∫–∞—Ç–µ–≥–æ—Ä—ñ—ó -->
  <div id="selectSubcategoryToDelete" class="form" style="display: none;">
    <h3>–í–∏–±–µ—Ä—ñ—Ç—å –ø—ñ–¥–∫–∞—Ç–µ–≥–æ—Ä—ñ—é –¥–ª—è –≤–∏–¥–∞–ª–µ–Ω–Ω—è</h3>

    <label for="deleteCategorySelect">–ö–∞—Ç–µ–≥–æ—Ä—ñ—è:</label><br>
    <select id="deleteCategorySelect"></select><br><br>

    <label for="deleteSubcategorySelect">–ü—ñ–¥–∫–∞—Ç–µ–≥–æ—Ä—ñ—è:</label><br>
    <select id="deleteSubcategorySelect" disabled></select><br><br>

    <button id="loadSubcategoryToDeleteBtn" type="button">–í–∏–±—Ä–∞—Ç–∏</button>
  </div>

  <div id="deleteSubcategoryForm" class="form" style="display: none;">
    <h3>–í–∏–¥–∞–ª–∏—Ç–∏ –ø—ñ–¥–∫–∞—Ç–µ–≥–æ—Ä—ñ—é</h3>
    <form id="deleteSubcategoryFormElement">
      <input type="hidden" id="deleteSubcategoryId">
      <p><strong>–ù–∞–∑–≤–∞:</strong> <span id="deleteSubcategoryName"></span></p>
      <p><strong>–ö–∞—Ç–µ–≥–æ—Ä—ñ—è:</strong> <span id="deleteSubcategoryCategoryName"></span></p>
      <button type="submit">–í–∏–¥–∞–ª–∏—Ç–∏</button>
    </form>
  </div>

  <!-- –§–æ—Ä–º–∞ –≤–∏–¥–∞–ª–µ–Ω–Ω—è –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó -->
  <div id="selectCategoryToDelete" class="form" style="display: none;">
    <h3>–û–±–µ—Ä—ñ—Ç—å –∫–∞—Ç–µ–≥–æ—Ä—ñ—é</h3>
    <select id="deleteCategorySelect" required></select>
    <button id="loadCategoryToDeleteBtn" type="button">–í–∏–±—Ä–∞—Ç–∏</button>
  </div>

  <div id="deleteCategoryConfirmForm" class="form" style="display: none;">
    <h3>–ü—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è –≤–∏–¥–∞–ª–µ–Ω–Ω—è</h3>
    <form id="deleteCategoryConfirmFormElement">
      <input type="hidden" id="deleteCategoryId">
      <p><strong>–ù–∞–∑–≤–∞ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó:</strong> <span id="deleteCategoryName"></span></p>
      <button type="submit">–í–∏–¥–∞–ª–∏—Ç–∏</button>
    </form>
  </div>

  <script>
    // –ù–∞–≤—ñ–≥–∞—Ü—ñ—è
    document.querySelectorAll('.sidebar-btn').forEach(button => {
      button.addEventListener('click', () => {
        location.href = button.dataset.target;
      });
    });

    // URL –¥–ª—è –∑–∞–ø–∏—Ç—ñ–≤
    // local const API_BASE = 'http://localhost:3000/api';
    const API_BASE = 'https://diplom-plumbering-shop.onrender.com';

    // –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—è
    document.getElementById('adminLoginForm').addEventListener('submit', async function (e) {
      e.preventDefault();

      const password = document.getElementById('password').value;
      const loginMessage = document.getElementById('loginMessage');

      try {
        const response = await fetch(`${API_BASE}/api/admin_password`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ password })
        });

        const result = await response.json();

        if (response.ok && result.success) {
          document.getElementById('admin-panel').style.display = 'block';
          document.getElementById('adminLoginForm').style.display = 'none';
          loginMessage.textContent = '';
        } else {
          loginMessage.textContent = result.message || '–ù–µ–≤—ñ—Ä–Ω–∏–π –ø–∞—Ä–æ–ª—å';
        }
      } catch (error) {
        console.error('–ü–æ–º–∏–ª–∫–∞ –∑–∞–ø–∏—Ç—É:', error);
        loginMessage.textContent = '–ü–æ–º–∏–ª–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ –∞–±–æ –º–µ—Ä–µ–∂—ñ';
      }
    });

    // –ü—ñ—Å–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Å—Ç–æ—Ä—ñ–Ω–∫–∏
    document.addEventListener('DOMContentLoaded', () => {
      loadCategories('editCategoryItem');
      loadSubcategories('editCategoryItem', 'editSubcategoryItem');
      loadCategories('editSubcategoryCategorySelect');
      loadCategories('editSubcategoryCategoryNameInForm');
      loadCategories('subcategoryCategory');
      loadItemsForEdit();
      loadItemsForDelete();
      loadCategories('deleteCategorySelect');
    });


    // –ü—Ä–∏—Ö–æ–≤—É—î –≤—Å—ñ —Ñ–æ—Ä–º–∏ –∑ –∫–ª–∞—Å–æ–º .form —ñ –ø–æ–∫–∞–∑—É—î –ª–∏—à–µ –æ–¥–Ω—É
    function showForm(formId) {
      document.querySelectorAll('.form').forEach(form => {
        form.style.display = 'none';
      });
      const target = document.getElementById(formId);
      if (target) target.style.display = 'block';
    }

    // –£–Ω—ñ–≤–µ—Ä—Å–∞–ª—å–Ω–∞ —Ñ—É–Ω–∫—Ü—ñ—è, —è–∫–∞ —Ö–æ–≤–∞—î –≤—Å—ñ –±–ª–æ–∫–∏ —Ä–µ–∂–∏–º—ñ–≤
    function hideAllModes() {
      document.getElementById('addOptions').style.display = 'none';
      document.getElementById('editOptions').style.display = 'none';

      const deleteOptions = document.getElementById('deleteOptions');
      if (deleteOptions) {
        deleteOptions.style.display = 'none';
      }
    }

    // –î–û–î–ê–í–ê–ù–ù–Ø 
    // –ü–æ–∫–∞–∑–∞—Ç–∏ —Ñ–æ—Ä–º–∏ –¥–ª—è –î–æ–¥–∞–≤–∞–Ω–Ω—è
    function showAddOptions() {
      hideAllModes();
      showForm();
      document.getElementById('addOptions').style.display = 'block';
    }
    function showAddProductForm() {
      showForm('productForm');
    }
    function showAddCategoryForm() {
      showForm('categoryForm');
    }
    function showAddSubcategoryForm() {
      showForm('subcategoryForm');
    }

    // –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∫–∞—Ç–µ–≥–æ—Ä—ñ–π
    function loadCategories(selectId, selectCategoryId = null) {
      const select = document.getElementById(selectId);
      if (!select) {
        console.error(`–ï–ª–µ–º–µ–Ω—Ç —ñ–∑ id "${selectId}" –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ`);
        return;
      }

      fetch(`${API_BASE}/api/categories`)
        .then(res => {
          if (!res.ok) throw new Error('–ù–µ –≤–¥–∞–ª–æ—Å—è –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó');
          return res.json();
        })
        .then(data => {
          select.innerHTML = '<option value="">–û–±–µ—Ä—ñ—Ç—å –∫–∞—Ç–µ–≥–æ—Ä—ñ—é</option>';

          if (!Array.isArray(data)) {
            console.error('–û—á—ñ–∫—É–≤–∞–≤—Å—è –º–∞—Å–∏–≤, –∞–ª–µ –æ—Ç—Ä–∏–º–∞–Ω–æ:', data);
            return;
          }

          data.forEach(cat => {
            const option = document.createElement('option');
            option.value = cat.category_id || cat.id;
            option.textContent = cat.category_name || cat.name;

            if (selectCategoryId && String(option.value) === String(selectCategoryId)) {
              option.selected = true;
            }
            select.appendChild(option);
          });
        })
        .catch(err => console.error('–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ –∫–∞—Ç–µ–≥–æ—Ä—ñ–π:', err));
    }

    // –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –ø—ñ–¥–∫–∞—Ç–µ–≥–æ—Ä—ñ–π –ø—Ä–∏ –≤–∏–±–æ—Ä—ñ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó
    function loadSubcategories(categorySelectId, subcategorySelectId) {
      const catSelect = document.getElementById(categorySelectId);
      const subSelect = document.getElementById(subcategorySelectId);

      if (!catSelect || !subSelect) {
        console.error(`–ï–ª–µ–º–µ–Ω—Ç –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ: ${categorySelectId} –∞–±–æ ${subcategorySelectId}`);
        return;
      }

      const updateSubcategories = () => {
        const categoryId = catSelect.value;
        subSelect.innerHTML = '<option value="">–û–±–µ—Ä—ñ—Ç—å –ø—ñ–¥–∫–∞—Ç–µ–≥–æ—Ä—ñ—é</option>';

        if (!categoryId) {
          console.warn('–ö–∞—Ç–µ–≥–æ—Ä—ñ—è –Ω–µ –≤–∏–±—Ä–∞–Ω–∞');
          return;
        }

        fetch(`${API_BASE}/api/subcategories/${categoryId}`)
          .then(res => {
            if (!res.ok) throw new Error('–ù–µ –≤–¥–∞–ª–æ—Å—è –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –ø—ñ–¥–∫–∞—Ç–µ–≥–æ—Ä—ñ—ó');
            return res.json();
          })
          .then(data => {
            if (!Array.isArray(data)) {
              console.error('–û—á—ñ–∫—É–≤–∞–≤—Å—è –º–∞—Å–∏–≤, –∞–ª–µ –æ—Ç—Ä–∏–º–∞–Ω–æ:', data);
              return;
            }

            data.forEach(sub => {
              const option = document.createElement('option');
              option.value = sub.id;
              option.textContent = sub.subcategory_name || sub.name;
              subSelect.appendChild(option);
            });
            subSelect.disabled = false;
          })
          .catch(err => console.error('–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –æ—Ç—Ä–∏–º–∞–Ω–Ω—ñ –ø—ñ–¥–∫–∞—Ç–µ–≥–æ—Ä—ñ–π:', err));
      };

      if (!catSelect._hasChangeListener) {
        catSelect.addEventListener('change', updateSubcategories);
        catSelect._hasChangeListener = true;
      }

      if (catSelect.value) {
        updateSubcategories();
      }
    }



    // –î–æ–¥–∞–≤–∞–Ω–Ω—è —Ç–æ–≤–∞—Ä—É
    document.getElementById('addProductForm').addEventListener('submit', function (e) {
      e.preventDefault();

      const form = document.getElementById('addProductForm');
      const formData = new FormData();

      // –ó–æ–±—Ä–∞–∂–µ–Ω–Ω—è
      const imageFile = document.getElementById('editItemImage').files[0];
      if (imageFile) {
        formData.append('image', imageFile);
      }

      // –Ü–Ω—à—ñ –ø–æ–ª—è
      formData.append('name', document.getElementById('productName').value);
      formData.append('category_id', document.getElementById('category').value);
      formData.append('subcategory_id', document.getElementById('subcategory').value || '');
      formData.append('description', document.getElementById('productDescription').value);
      formData.append('price', document.getElementById('productPrice').value.replace(',', '.'));
      formData.append('stock', document.getElementById('productStock').value);

      fetch(`${API_BASE}/api/products`, {
        method: 'POST',
        body: formData
      })
        .then(res => res.json())
        .then(result => {
          alert(result.message || '–¢–æ–≤–∞—Ä –¥–æ–¥–∞–Ω–æ');
          form.reset();
          document.getElementById('currentItemImage').src = '';
        })
        .catch(error => {
          console.error('–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –¥–æ–¥–∞–≤–∞–Ω–Ω—ñ —Ç–æ–≤–∞—Ä—É:', error);
          alert('–°—Ç–∞–ª–∞—Å—è –ø–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –¥–æ–¥–∞–≤–∞–Ω–Ω—ñ —Ç–æ–≤–∞—Ä—É');
        });
    });


    // –î–æ–¥–∞–≤–∞–Ω–Ω—è –ø—ñ–¥–∫–∞—Çe–≥–æ—Ä—ñ—ó
    document.getElementById('addSubcategoryForm').addEventListener('submit', function (e) {
      e.preventDefault();

      const data = {
        name: document.getElementById('subcategoryName').value,
        category_id: document.getElementById('subcategoryCategory').value
      };

      console.log('API_BASE:', API_BASE);
      console.log('name:', data.name);
      console.log('category_id:', data.category_id);
      fetch(`${API_BASE}/api/subcategories`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
      })
        .then(res => res.json())
        .then(result => {
          alert(result.message || '–ü—ñ–¥–∫–∞—Ç–µ–≥–æ—Ä—ñ—é –¥–æ–¥–∞–Ω–æ');
          document.getElementById('addSubcategoryForm').reset();
        })
        .catch(error => {
          console.error('–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –¥–æ–¥–∞–≤–∞–Ω–Ω—ñ –ø—ñ–¥–∫–∞—Ç–µ–≥–æ—Ä—ñ—ó:', error);
          alert('–°—Ç–∞–ª–∞—Å—è –ø–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –¥–æ–¥–∞–≤–∞–Ω–Ω—ñ –ø—ñ–¥–∫–∞—Ç–µ–≥–æ—Ä—ñ—ó');
        });
    });

    // –î–æ–¥–∞–≤–∞–Ω–Ω—è –∫–∞—Çe–≥–æ—Ä—ñ—ó 
    document.getElementById('addCategoryForm').addEventListener('submit', function (e) {
      e.preventDefault();

      const data = {
        name: document.getElementById('categoryName').value,
      };

      console.log('API_BASE:', API_BASE);
      fetch(`${API_BASE}/api/categories`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
      })
        .then(res => res.json())
        .then(result => {
          alert(result.message || '–ö–∞—Ç–µ–≥–æ—Ä—ñ—é –¥–æ–¥–∞–Ω–æ');
          document.getElementById('addCategoryForm').reset();
        })
        .catch(error => {
          console.error('–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –¥–æ–¥–∞–≤–∞–Ω–Ω—ñ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó:', error);
          alert('–°—Ç–∞–ª–∞—Å—è –ø–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –¥–æ–¥–∞–≤–∞–Ω–Ω—ñ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó');
        });
    });

    // –†–ï–î–ê–ì–£–í–ê–ù–ù–Ø 
    // –ü–æ–∫–∞–∑–∞—Ç–∏ –≤–∏–±—ñ—Ä –¥—ñ–π –¥–ª—è —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è
    function showEditOptions() {
      hideAllModes();
      showForm();
      document.getElementById('editOptions').style.display = 'block';

      loadItemsForEdit();
    }
    function showEditProductForm() {
      showForm('editItemForm');
    }
    function showEditCategoryForm() {
      showForm('selectCategoryToEdit');
    }
    function showEditSubcategoryForm() {
      showForm('selectSubcategoryToEdit');
    }

    // –†–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è —Ç–æ–≤–∞—Ä—É
    // –ü—ñ–¥—Ç—è–≥–Ω—É—Ç–∏ —Å–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä—ñ–≤ —É select
    function loadItemsForEdit() {
      fetch(`${API_BASE}/api/products`)
        .then(res => res.json())
        .then(data => {
          console.log('–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω—ñ —Ç–æ–≤–∞—Ä–∏:', data);
          const select = document.getElementById('editItemSelect');
          select.innerHTML = '<option value="">-- –í–∏–±–µ—Ä—ñ—Ç—å —Ç–æ–≤–∞—Ä --</option>';

          if (Array.isArray(data)) {
            data.forEach(item => {
              const option = document.createElement('option');
              option.value = item.product_id;
              option.textContent = item.name;
              select.appendChild(option);
            });
          } else {
            console.error('–û—á—ñ–∫—É–≤–∞–≤ –º–∞—Å–∏–≤, –∞–ª–µ –æ—Ç—Ä–∏–º–∞–≤:', data);
          }
        })
        .catch(err => console.error('–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ —Ç–æ–≤–∞—Ä—ñ–≤:', err));
    }

    // –ü—Ä–∏ –Ω–∞—Ç–∏—Å–∫–∞–Ω–Ω—ñ "–í–∏–±—Ä–∞—Ç–∏"
    document.getElementById('loadItemDataBtn').addEventListener('click', () => {
      const itemId = document.getElementById('editItemSelect').value;
      console.log('ID —Ç–æ–≤–∞—Ä—É:', itemId);

      if (!itemId) {
        alert("–û–±–µ—Ä—ñ—Ç—å —Ç–æ–≤–∞—Ä –∑—ñ —Å–ø–∏—Å–∫—É");
        return;
      };

      fetch(`${API_BASE}/api/products/${itemId}`)
        .then(res => {
          if (!res.ok) throw new Error('–ù–µ –≤–¥–∞–ª–æ—Å—è –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ —Ç–æ–≤–∞—Ä');
          return res.json();
        })
        .then(item => {
          console.log('–û—Ç—Ä–∏–º–∞–Ω–∏–π —Ç–æ–≤–∞—Ä –∑ API:', item);

          if (Array.isArray(item)) item = item[0];
          if (!item || !item.product_id) throw new Error('–ù–µ–≤—ñ—Ä–Ω—ñ –¥–∞–Ω—ñ —Ç–æ–≤–∞—Ä—É');
          console.log('–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω—ñ —Ç–æ–≤–∞—Ä–∏:', item);

          document.getElementById('editItemIdItem').value = item.product_id;

          document.getElementById('currentItemName').textContent = item.name || '';
          document.getElementById('editItemNameItem').value = item.name || '';

          document.getElementById('currentDescription').textContent = item.description || '';
          document.getElementById('editDescriptionItem').value = item.description || '';

          document.getElementById('currentCategoryName').textContent = item.category_name || '';
          document.getElementById('currentSubcategoryName').textContent = item.subcategory_name || '';

          document.getElementById('currentQuantity').textContent = item.stock ?? '0';
          document.getElementById('editQuantityItem').value = item.stock ?? '';

          document.getElementById('currentPrice').textContent = item.price ?? '0.00';
          document.getElementById('editPriceItem').value = item.price ?? '';

          const imgEl = document.getElementById('currentImage');
          if (imgEl) {
            imgEl.src = item.image && item.image.trim() !== '' ? item.image : '/uploads/products/no-image.jpg';
          }
          console.log('item:', item);

          return Promise.all([
            loadCategories('editCategoryItem', item.category_id),
            loadSubcategories('editCategoryItem', 'editSubcategoryItem')
          ]);
        })
        .then(() => {
          document.getElementById('editItemForm').style.display = 'block';
        })
        .catch(err => {
          console.error(err);
        });
      console.log('–û–±—Ä–∞–Ω–∏–π —Ç–æ–≤–∞—Ä:', itemId);
      console.log('–£ select –∑–∞—Ä–∞–∑ —î –æ–ø—Ü—ñ—ó:', [...document.getElementById('editItemSelect').options].map(o => o.textContent));

      // –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è
      document.getElementById('editItemFormElement').addEventListener('submit', function (e) {
        e.preventDefault();

        const id = document.getElementById('editItemIdItem').value;

        const formData = new FormData();
        formData.append('name', document.getElementById('editItemNameItem').value);
        formData.append('category_id', document.getElementById('editCategoryItem').value);
        formData.append('subcategory_id', document.getElementById('editSubcategoryItem').value);
        formData.append('description', document.getElementById('editDescriptionItem').value);
        formData.append('stock', document.getElementById('editQuantityItem').value);
        formData.append('price', document.getElementById('editPriceItem').value);

        const imageFile = document.getElementById('editImageItem').files[0];
        if (imageFile) {
          formData.append('image', imageFile);
        }

        fetch(`${API_BASE}/api/products/${id}`, {
          method: 'PUT',
          body: formData
        })
          .then(async res => {
            const content = await res.text();
            let data;

            try {
              data = JSON.parse(content);
            }
            catch (e) {
              alert('–í—ñ–¥–ø–æ–≤—ñ–¥—å –Ω–µ —î JSON: ' + e.message);
              throw new Error('–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∏–π JSON')
            }

            if (!res.ok) {
              alert(data.error || "–ü–æ–º–º–∏–ª–∫–∞ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è");
              throw new Error(data.error || "–ü–æ–º–º–∏–ª–∫–∞ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è");
            }
            alert(data.message || '–¢–æ–≤–∞—Ä –æ–Ω–æ–≤–ª–µ–Ω–æ');
            loadItemsForEdit();
            document.getElementById('editItemForm').style.display = 'none';
          })
          .catch(err => {
            console.error('–ü–æ–º–∏–ª–∫–∞ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è:', err);
          });
      });
    })

    // –†–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è –ø—ñ–¥–∫–∞—Ç–µ–≥–æ—Ä—ñ—ó
    // –ü—ñ–¥—Ç—è–≥–Ω—É—Ç–∏ —Å–ø–∏—Å–æ–∫ –ø—ñ–¥–∫–∞—Ç–µ–≥–æ—Ä—ñ–π —É select
    loadSubcategories('editSubcategoryCategorySelect', 'editSubcategorySelect');

    // –ü—Ä–∏ –Ω–∞—Ç–∏—Å–∫–∞–Ω–Ω—ñ "–í–∏–±—Ä–∞—Ç–∏" –¥–ª—è –ø—ñ–¥–∫–∞—Ç–µ–≥–æ—Ä—ñ—ó
    document.getElementById('loadSubcategoryDataBtn').addEventListener('click', (e) => {
      e.preventDefault();
      const subcategoryId = document.getElementById('editSubcategorySelect').value;
      if (!subcategoryId) return alert('–û–±–µ—Ä—ñ—Ç—å –ø—ñ–¥–∫–∞—Ç–µ–≥–æ—Ä—ñ—é');

      fetch(`${API_BASE}/api/subcategories/id/${subcategoryId}`)
        .then(res => {
          if (!res.ok) throw new Error(`HTTP ${res.status}`);
          return res.json();
        })
        .then(subArray => {
          if (!Array.isArray(subArray) || subArray.length === 0) {
            throw new Error('–ü—ñ–¥–∫–∞—Ç–µ–≥–æ—Ä—ñ—è –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–∞');
          }
          const sub = subArray[0];

          document.getElementById('editSubcategoryId').value = sub.id;
          document.getElementById('currentSubcategoryNameSub').textContent = sub.subcategory_name;
          document.getElementById('editSubcategoryName').value = sub.subcategory_name;

          loadCategories('editSubcategoryCategoryNameInForm', sub.category_id);
          document.getElementById('editSubcategoryForm').style.display = 'block';

          const container = document.getElementById('editSubcategoryForm');
          if (container) {
            container.style.display = 'block';
          } else {
            console.warn('–ï–ª–µ–º–µ–Ω—Ç EditSubcategoryForm –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ');
          }
        })
        .catch(err => {
          console.error('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –ø—ñ–¥–∫–∞—Ç–µ–≥–æ—Ä—ñ—ó:', err);
          alert('–ù–µ –≤–¥–∞–ª–æ—Å—è –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –¥–∞–Ω—ñ –ø—ñ–¥–∫–∞—Ç–µ–≥–æ—Ä—ñ—ó');
        });
    });

    // –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –ø—ñ–¥–∫–∞—Ç–µ–≥–æ—Ä—ñ—ó
    document.getElementById('editSubcategoryFormElement').addEventListener('submit', function (e) {
      e.preventDefault();

      const id = document.getElementById('editSubcategoryId').value;
      const updatedSubcategory = {
        name: document.getElementById('editSubcategoryName').value,
        category_id: document.getElementById('editSubcategoryCategoryNameInForm').value
      };

      fetch(`${API_BASE}/api/subcategories/${id}`, {
        method: 'PUT',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(updatedSubcategory)
      })
        .then(res => res.json())
        .then(result => {
          alert(result.message || '–ü—ñ–¥–∫–∞—Ç–µ–≥–æ—Ä—ñ—é –æ–Ω–æ–≤–ª–µ–Ω–æ');
          loadCategories('editSubcategoryCategorySelect');
          document.getElementById('editSubcategoryForm').style.display = 'none';
        })
        .catch(err => {
          console.error('–ü–æ–º–∏–ª–∫–∞ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –ø—ñ–¥–∫–∞—Ç–µ–≥–æ—Ä—ñ—ó:', err);
          alert('–°—Ç–∞–ª–∞—Å—è –ø–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –æ–Ω–æ–≤–ª–µ–Ω–Ω—ñ');
        });
    });

    loadCategories('editCategorySelect');
    // –†–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó
    document.getElementById('loadCategoryDataBtn').addEventListener('click', (e) => {
      e.preventDefault();

      const categoryId = document.getElementById('editCategorySelect').value;
      if (!categoryId) return alert('–û–±–µ—Ä—ñ—Ç—å –∫–∞—Ç–µ–≥–æ—Ä—ñ—é');

      fetch(`${API_BASE}/api/categories/${categoryId}`)
        .then(res => {
          if (!res.ok) throw new Error(`HTTP ${res.status}`);
          return res.json();
        })
        .then(cat => {
          document.getElementById('editCategoryCategoryId').value = cat.category_id;
          document.getElementById('editCategoryName').value = cat.category_name || cat.name;
          document.getElementById('currentCategoryNameCat').textContent = cat.category_name;

          document.getElementById('editCategoryForm').style.display = 'block';
        })
        .catch(err => {
          console.error('–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ –∫–∞—Ç–µ–≥–æ—Ä—ñ–π:', err);
          alert('–ù–µ –≤–¥–∞–ª–æ—Å—è –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –¥–∞–Ω—ñ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó');
        });
    });

    // –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó
    document.getElementById('editCategoryFormElement').addEventListener('submit', function (e) {
      e.preventDefault();

      const categoryId = document.getElementById('editCategoryCategoryId')?.value;
      const updatedName = document.getElementById('editCategoryName')?.value;
      console.log('ID –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è :', categoryId);

      if (!updatedName.trim()) {
        return alert('–ù–∞–∑–≤–∞ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó –Ω–µ –º–æ–∂–µ –±—É—Ç–∏ –ø–æ—Ä–æ–∂–Ω—å–æ—é');
      }

      fetch(`${API_BASE}/api/categories/${categoryId}`, {
        method: 'PUT',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ name: updatedName })
      })
        .then(res => {
          if (!res.ok) throw Error(`HTTP ${res.status}`);
          return res.json();
        })
        .then(result => {

          const select = document.getElementById('editCategorySelect');
          const previousValue = select.value;

          loadCategories('editCategorySelect', previousValue);
          document.getElementById('editCategoryForm').style.display = 'none';
        })
        .catch(err => {
          console.error('–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó:', err);
          alert('–ù–µ –≤–¥–∞–ª–æ—Å—è –æ—Ç—Ä–∏–º–∞—Ç–∏ –¥–∞–Ω—ñ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó');
        });
    });

    // –í–ò–î–ê–õ–ï–ù–ù–Ø
    // –ü–æ–∫–∞–∑–∞—Ç–∏ —Ñ–æ—Ä–º—É 
    function showDeleteOptions() {
      hideAllModes();
      document.getElementById('deleteOptions').style.display = 'block';
      showForm();
    }
    function showDeleteProductForm() {
      showForm('selectItemToDelete');
    }
    function showDeleteCategoryForm() {
      showForm('selectCategoryToDelete');
    }
    function showDeleteSubcategoryForm() {
      showForm('selectSubcategoryToDelete');
    }

    // –í–∏–¥–∞–ª–µ–Ω–Ω—è —Ç–æ–≤–∞—Ä—É
    function loadItemsForDelete() {
      fetch(`${API_BASE}/api/products`)
        .then(res => res.json())
        .then(data => {
          const select = document.getElementById('deleteItemSelect');
          select.innerHTML = '<option value="">-- –í–∏–±–µ—Ä—ñ—Ç—å —Ç–æ–≤–∞—Ä --</option>';

          if (Array.isArray(data)) {
            data.forEach(item => {
              const option = document.createElement('option');
              option.value = item.product_id;
              option.textContent = item.name;
              select.appendChild(option);
            });
          } else {
            console.error('–û—á—ñ–∫—É–≤–∞–≤ –º–∞—Å–∏–≤, –∞–ª–µ –æ—Ç—Ä–∏–º–∞–≤:', data);
          }
        })
        .catch(err => console.error('–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ —Ç–æ–≤–∞—Ä—ñ–≤ –¥–ª—è –≤–∏–¥–∞–ª–µ–Ω–Ω—è:', err));
    }

    document.getElementById('loadItemToDeleteBtn').addEventListener('click', function () {
      const select = document.getElementById('deleteItemSelect');
      const itemId = select.value;
      console.log('–í–∏–±—Ä–∞–Ω–∏–π —Ç–æ–≤–∞—Ä ID:', itemId);
      if (!itemId) return alert('–û–±–µ—Ä—ñ—Ç—å —Ç–æ–≤–∞—Ä');

      fetch(`${API_BASE}/api/products/${itemId}`)
        .then(res => res.json())
        .then(item => {
          if (!item || !item.product_id) {
            alert('–ù–µ –≤–¥–∞–ª–æ—Å—è –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ —Ç–æ–≤–∞—Ä');
            return;
          }

          document.getElementById('deleteItemId').value = item.product_id;
          document.getElementById('deleteItemName').textContent = item.name;
          document.getElementById('deleteItemPrice').textContent = item.price;
          document.getElementById('deleteItemCategory').textContent = item.category_name;
          document.getElementById('deleteItemSubcategory').textContent = item.subcategory_name;
          document.getElementById('deleteItemStock').textContent = item.stock;
          document.getElementById('deleteItemDescription').textContent = item.description;
          document.getElementById('deleteItemImage').src = `${API_BASE}/uploads/products/${item.image || 'no-image.jpg'}`;

          showForm('deleteItemForm');
        });
    });

    document.getElementById('deleteItemFormElement').addEventListener('submit', function (e) {
      e.preventDefault();
      const id = document.getElementById('deleteItemId').value;
      console.log('ID, —è–∫–∏–π –≤—ñ–¥–ø—Ä–∞–≤–ª—è—î—Ç—å—Å—è –Ω–∞ –≤–∏–¥–∞–ª–µ–Ω–Ω—è:', id);

      if (!id) {
        alert('id —Ç–æ–≤–∞—Ä—É –≤—ñ–¥—Å—É—Ç–Ω—ñ–π. –û–±–µ—Ä—ñ—Ç—å —Ç–æ–≤–∞—Ä');
        return;
      }

      fetch(`${API_BASE}/api/products/${id}`, { method: 'DELETE' })
        .then(res => {
          if (!res.ok) throw new Error('–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –≤–∏–¥–∞–ª–µ–Ω–Ω—ñ —Ç–æ–≤–∞—Ä—É');
          return res.json();
        })
        .then(result => {
          alert(result.message || '–¢–æ–≤–∞—Ä –≤–∏–¥–∞–ª–µ–Ω–æ');
          loadItems('deleteItemSelect');
          showForm('selectItemToDelete');
        })
        .catch(err => alert('–ù–µ –≤–¥–∞–ª–æ—Å—è –≤–∏–¥–∞–ª–∏—Ç–∏ —Ç–æ–≤–∞—Ä'));
    });

    // –í–∏–¥–∞–ª–µ–Ω–Ω—è –ø—ñ–¥–∫–∞—Ç–µ–≥–æ—Ä—ñ—ó
    function showDeleteSubcategorySelection() {
      showForm('selectSubcategoryToDelete');
      initDeleteSubcategoryForm();
    }
    // –ü—ñ–¥–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó —Ç–∞ –ø—ñ–¥–∫–∞—Ç–µ–≥–æ—Ä—ñ—ó –¥–ª—è –≤–∏–¥–∞–ª–µ–Ω–Ω—è
    function initDeleteSubcategoryForm() {
      loadCategories('deleteCategorySelect');
      loadSubcategories('deleteCategorySelect', 'deleteSubcategorySelect');

      document.getElementById('deleteSubcategorySelect').disabled = true;
    }

    document.getElementById('loadSubcategoryToDeleteBtn').addEventListener('click', () => {
      const catSelect = document.getElementById('deleteCategorySelect');
      const subSelect = document.getElementById('deleteSubcategorySelect');

      if (!catSelect.value) return alert('–û–±–µ—Ä—ñ—Ç—å –∫–∞—Ç–µ–≥–æ—Ä—ñ—é');
      if (!subSelect.value) return alert('–û–±–µ—Ä—ñ—Ç—å –ø—ñ–¥–∫–∞—Ç–µ–≥–æ—Ä—ñ—é');

      fetch(`${API_BASE}/api/subcategories/${catSelect.value}`)
        .then(res => {
          if (!res.ok) throw new Error(`–°—Ç–∞—Ç—É—Å –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ: ${res.status}`);
          return res.json();
        })
        .then(subcategories => {
          const sub = subcategories.find(s => s.id == subSelect.value);
          if (!sub) {
            alert('–ù–µ –≤–¥–∞–ª–æ—Å—è –∑–Ω–∞–π—Ç–∏ –ø—ñ–¥–∫–∞—Ç–µ–≥–æ—Ä—ñ—é');
            return;
          }

          document.getElementById('deleteSubcategoryId').value = sub.id;
          document.getElementById('deleteSubcategoryName').textContent = sub.subcategory_name || sub.name;
          document.getElementById('deleteSubcategoryCategoryName').textContent = catSelect.options[catSelect.selectedIndex].text;

          showForm('deleteSubcategoryForm');
        })
        .catch(err => {
          console.error('–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ –ø—ñ–¥–∫–∞—Ç–µ–≥–æ—Ä—ñ—ó:', err);
          alert('–ù–µ –≤–¥–∞–ª–æ—Å—è –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ –ø—ñ–¥–∫–∞—Ç–µ–≥–æ—Ä—ñ—é');
        });
    });

    document.getElementById('deleteSubcategoryFormElement').addEventListener('submit', (e) => {
      e.preventDefault();

      const id = document.getElementById('deleteSubcategoryId').value;
      if (!id) return alert('–û–±—Ä–∞—Ç–∏ –ø—ñ–¥–∫–∞—Ç–µ–≥–æ—Ä—ñ—é –¥–ª—è –≤–∏–¥–∞–ª–µ–Ω–Ω—è');

      fetch(`${API_BASE}/api/subcategories/${id}`, { method: 'DELETE' })
        .then(res => {
          if (!res.ok) throw new Error('–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –≤–∏–¥–∞–ª–µ–Ω–Ω—ñ –ø—ñ–¥–∫–∞—Ç–µ–≥–æ—Ä—ñ—ó');
          return res.json();
        })
        .then(result => {
          alert(result.message || '–ü—ñ–¥–∫–∞—Ç–µ–≥–æ—Ä—ñ—é –≤–∏–¥–∞–ª–µ–Ω–æ');

          initDeleteSubcategoryForm();

          showForm('selectSubcategoryToDelete');
        })
        .catch(err => {
          console.error('–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –≤–∏–¥–∞–ª–µ–Ω–Ω—ñ –ø—ñ–¥–∫–∞—Ç–µ–≥–æ—Ä—ñ—ó:', err);
          alert('–ù–µ –≤–¥–∞–ª–æ—Å—è –≤–∏–¥–∞–ª–∏—Ç–∏ –ø—ñ–¥–∫–∞—Ç–µ–≥–æ—Ä—ñ—é');
        });
    });


    // –í–∏–¥–∞–ª–µ–Ω–Ω—è –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó
    // –ü—ñ—Å–ª—è –Ω–∞—Ç–∏—Å–∫–∞–Ω–Ω—è "–í–∏–±—Ä–∞—Ç–∏"
    document.getElementById('loadCategoryToDeleteBtn').addEventListener('click', function () {
      const select = document.getElementById('deleteCategorySelect');
      const id = select.value;
      const name = select.options[select.selectedIndex]?.textContent;

      if (!id) return alert('–û–±–µ—Ä—ñ—Ç—å –∫–∞—Ç–µ–≥–æ—Ä—ñ—é');

      document.getElementById('deleteCategoryId').value = id;
      document.getElementById('deleteCategoryName').textContent = name;

      showForm('deleteCategoryConfirmForm');
    });

    document.getElementById('deleteCategoryConfirmFormElement').addEventListener('submit', function (e) {
      e.preventDefault();
      const id = document.getElementById('deleteCategoryId').value;

      fetch(`${API_BASE}/api/categories/${id}`, { method: 'DELETE' })
        .then(res => res.json())
        .then(result => {
          alert(result.message || '–ö–∞—Ç–µ–≥–æ—Ä—ñ—é –≤–∏–¥–∞–ª–µ–Ω–æ');
          loadCategories('deleteCategorySelect');
          showForm('selectCategoryToDelete');
        })
        .catch(err => alert('–ù–µ –≤–¥–∞–ª–æ—Å—è –≤–∏–¥–∞–ª–∏—Ç–∏ –∫–∞—Ç–µ–≥–æ—Ä—ñ—é'));
    });

    //–í–∏–¥–∞–ª–µ–Ω–Ω—è –Ω–µ–≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞–Ω–∏—Ö –∑–æ–±—Ä–∞–∂–µ–Ω—å
    function cleanupImages() {
      fetch('/api/images/cleanup', {
        method: 'DELETE',
      })
        .then(response => response.json())
        .then(data => {
          document.getElementById('cleanup-result').innerText = data.message;
        })
        .catch(error => {
          document.getElementById('cleanup-result').innerText = '–ü–æ–º–∏–ª–∫–∞: ' + error.message;
        });
    }

  </script>
</body>

</html>