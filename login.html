<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <title>–ú–∞–≥–∞–∑–∏–Ω —Å–∞–Ω—Ç–µ—Ö–Ω—ñ–∫–∏</title>
<style>
.topnav-bar {
  display: flex;
  justify-content: space-between;
  align-items: center;
  background-color: #37ddf3;
  padding: 14px 20px;
  font-weight: bold;
}

.shop-name {
  font-size: 20px;
  color: black;
}

.auth-buttons a {
  text-decoration: none;
  padding: 10px 15px;
  margin-left: 10px;
  background-color: #e6f4f8;
  color: black;
  border-radius: 5px;
  transition: background-color 0.3s;
}

.auth-buttons a:hover {
  background-color: #2ac1d5;
}

.product-card {
  border: 1px solid #ccc;
  border-radius: 10px;
  padding: 1rem;
  width: 250px;
  background-color: #f9f9f9;
  box-shadow: 2px 2px 6px rgba(0,0,0,0.1);
  transition: transform 0.2s;
}

.product-card:hover {
  transform: scale(1.03);
}

</style>
</head>
<body>
  <div class="topnav-bar">
    <div class="shop-name">Plumbering shop</div>
    <div class="auth-buttons" id="authButtons">
      <a href="login.html" id="loginBtn">–£–≤—ñ–π—Ç–∏</a>
      <a href="/logout" id="logoutBtn" style="display:none;">–í–∏–π—Ç–∏</a>
      <a href="cart.html">–ö–æ—à–∏–∫ üõí</a>
    </div>
  </div>

  <nav class="topnav">
    <a href="main.html">–ì–æ–ª–æ–≤–Ω–∞</a>
    <a href="aboutUs.html">–ü—Ä–æ –Ω–∞—Å</a>
    <a href="admin.html">–ê–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä</a>
  </nav>

  <h2>–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—è / –†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è</h2>
  <div>
    <button onclick="switchForm('login')">–£–≤—ñ–π—Ç–∏</button>
    <button onclick="switchForm('register')">–ó–∞—Ä–µ—î—Å—Ç—Ä—É–≤–∞—Ç–∏—Å—è</button>
  </div>

  <!-- –§–æ—Ä–º–∞ –≤—Ö–æ–¥—É -->
  <form id="loginForm">
    <h3>–í—Ö—ñ–¥</h3>
    <label>Email:</label><br>
    <input type="email" id="loginEmail" required><br>
    <label>–ü–∞—Ä–æ–ª—å:</label><br>
    <input type="password" id="loginPassword" required><br><br>
    <button type="submit">–£–≤—ñ–π—Ç–∏</button>
  </form>

  <!-- –§–æ—Ä–º–∞ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó -->
  <form id="registerForm" method="POST" action="/register" style="display:none;">
    <h3>–†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è</h3>
    <label>–Ü–º‚Äô—è:</label><br>
    <input type="text" name="name" required><br>
    <label>Email:</label><br>
    <input type="email" name="email" required><br>
    <label>–ü–∞—Ä–æ–ª—å:</label><br>
    <input type="password" name="password" required><br><br>
    <button type="submit">–ó–∞—Ä–µ—î—Å—Ç—Ä—É–≤–∞—Ç–∏—Å—è</button>
  </form>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
    const userId = localStorage.getItem('userId');
    const userName = localStorage.getItem('userName');
    const logoutBtn = document.getElementById('logoutBtn');
    const loginBtn = document.getElementById('loginBtn');

    if (userId && userName) {
      if (logoutBtn) logoutBtn.style.display = 'inline-block';
      if (loginBtn) loginBtn.style.display = 'none';
    } else {
      if (logoutBtn) logoutBtn.style.display = 'none';
      if (loginBtn) loginBtn.style.display = 'inline-block';
    }

    if (logoutBtn) {
      logoutBtn.addEventListener('click', async (e) => {
        e.preventDefault();
        await fetch('/logout');
        localStorage.clear();
        window.location.href = 'login.html';
      });
    }
  });

    function switchForm(type) {
      document.getElementById('loginForm').style.display = type === 'login' ? 'block' : 'none';
      document.getElementById('registerForm').style.display = type === 'register' ? 'block' : 'none';
    }

    document.getElementById('loginForm').addEventListener('submit', async function (e) {
      e.preventDefault();

      const email = document.getElementById('loginEmail').value;
      const password = document.getElementById('loginPassword').value;

      try {
        const res = await fetch('/login', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email, password })
        });

        if (!res.ok) {
          const error = await res.text();
          alert(error || '–ü–æ–º–∏–ª–∫–∞ –≤—Ö–æ–¥—É');
          return;
        }

        const data = await res.json();

        localStorage.setItem('userId', data.userId);
        localStorage.setItem('userName', data.name);
        localStorage.setItem('userRole', data.role);
        localStorage.setItem('cartId', data.cartId);

        window.location.href = 'main.html';
      } catch (err) {
        console.error('–ü–æ–º–∏–ª–∫–∞ –≤—Ö–æ–¥—É:', err);
        alert('–°–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∏–π –∞–±–æ —Å—Ç–∞–ª–∞—Å—è –ø–æ–º–∏–ª–∫–∞');
      }
    });
  </script>
</body>
</html>